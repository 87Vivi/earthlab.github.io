---
layout: single
category: courses
title: "Lidar Data in R - Remote Sensing Uncertainty"
permalink: /courses/earth-analytics/remote-sensing-uncertainty/
modified: '2017-09-27'
week-landing: 5
week: 5
sidebar:
  nav:
comments: false
author_profile: false
course: "earth-analytics"
module-type: 'session'
---

{% include toc title="This Week" icon="file-text" %}


<div class="notice--info" markdown="1">

## <i class="fa fa-ship" aria-hidden="true"></i> Welcome to Week {{ page.week }}!

Welcome to week {{ page.week }} of Earth Analytics! This week, we will explore
the concept of uncertainty surrounding lidar raster data (and remote sensing
data in general).  We will use the same data that you downloaded last week for class. 

[<i class="fa fa-download" aria-hidden="true"></i> Download Week 5 Data (~500 MB)](https://ndownloader.figshare.com/files/7525363){:data-proofer-ignore='' .btn }

<a href="https://docs.google.com/a/colorado.edu/document/d/1TAHGcro6kJS4lA4IbTNsvKLEkEqtHnXRKu8vyeMFzPI/edit?usp=sharing" target="_blank" class='btn'>View google doc</a>
</div>


|  Time | Topic   | Speaker   |
|---|---|---|---|---|
| 9:30 - 9:40  | Review |   |
| 9:40 - 10:30  | Guest speaker - Chris Crosby, UNAVCO / Open Topography |   |
| 10:30 - 12:20  | Coding: Use lidar to characterize vegetation / uncertainty |   |

### 1. Readings
* <a href="http://journals.plos.org/plosone/article?id=10.1371/journal.pone.0054776" target="_blank">Influence of Vegetation Structure on Lidar-derived Canopy Height and Fractional Cover in Forested Riparian Buffers During Leaf-Off and Leaf-On Conditions</a>
* <a href="http://www.sciencedirect.com/science/article/pii/S0303243403000047" target="_blank">The characterization and measurement of land cover change through remote sensing: problems in operational applications?</a>
*  <a href="https://www.nde-ed.org/GeneralResources/ErrorAnalysis/UncertaintyTerms.htm" target="_blank">Learn more about the various uncertainty terms.</a>



### 2. Complete the Assignment Below (5 points)

<div class="notice--warning" markdown="1">

## <i class="fa fa-pencil-square-o" aria-hidden="true"></i> Homework Submission

### Produce a .pdf report

Create a new `R markdown `document. Name it: **lastName-firstInitial-week5.Rmd**
Within your `.Rmd` document, include the plots listed below. When you are done
with your report, use `knitr` to convert it to `html` format. Submit both the
`.Rmd` file and the `.html` file. Be sure to name your files as instructed above!

#### Use knitr Code Chunk Arguments
In your final report, use the following knitr code chunk arguments to hide messages
and warnings and code as you see fit.

* `message = FALSE`, `warning = FALSE` Hide warnings and messages in a code chunk
* `echo = FALSE` Hide code and just show code output
* `fig.cap = "caption here"` Add a caption to a figure. When you do this, each figure needs to be in it's own code chunk!

#### Answer Questions Below in Your Report
2. **Write *at least* 2 paragraphs:** In this class we learned about lidar and canopy height models. We then compared height values extracted from a canopy height model compared to height values measured by humans at each study site. Compare the results of the scatter plots below (plots 3 and 4).
Which lidar estimate (max vs average) does a better job of comparing measured
average or max tree height ? Any ideas why one is better than the other? Discuss
this referencing what you see in the plots and the readings assigned for homework.
3. **Write *at least* 1 paragraph:** List a minimum of 3 sources of uncertainty associated with the lidar derived tree heights and 3 sources of uncertainty associated with *in situ* measurements of tree height. For each source of uncertainty, specify whether it is a random or systematic error source. Be sure to reference the plots in your report when discussing this. Note: the assigned readings will help you write this paragraph.

#### Include the Plots Below
Be sure to describe what each plot shows in your final report.

#### Plot 1 Study area plot  

Create a plot that shows the location of the California field sites used 
in this week's lessons, relative to the entire United States. You can use any 
approach that you want to create this plot 
such as ggmap, maps, or a manually created plot using site shapefiles! 
 
#### Plots 1 - 4: Scatterplots

For both the SJER and SOAP field sites, create scatter plots that compare:

* **MAXIMUM** canopy height model height in meters, extracted within a 20 meter radius, compared to **MAXIMUM** tree
height derived from the in situ field site data.
* **AVERAGE** canopy height model height in meters, extracted within a 20 meter radius, compared to **AVERAGE** tree
height derived from the in situ field site data.

#### Plot 5 - 8 Difference Bar Plots
For both the SJER and SOAP field sites, create barplots that show the DIFFERENCE between:

* Extracted lidar max canopy height model height compared to measured max height per plot.
* Extracted lidar average canopy height model compared to measured average height per plot.

#### Graduate Students Only
Add a regression line to each scatterplot. For both plots write a thoughtful paragraph
describing what the regression relationship tells you about the relationship
between lidar and measured vegetation height. Does the comparison between lidar and
measured average height look stronger? Or Maximum height? Why might one be "better"
or a strong relationship than the other.

### IMPORTANT: For All Plots
* Label x and y axes appropriately - include units
* Add a title to your plot that describes what the plot shows
* Add a 2-3 sentence caption below each plot that describes what it shows HINT: you can use the knitr argument fig.cap="Caption here" if you are knitting to pdf to automatically add captions.

## Homework Due: Monday October 9th 2017 @ 8am.
Submit your report in both `.Rmd` and `.html` format to the D2l dropbox. Once again
you are welcome to submit a `.pdf` instead of `.html` if you wish!

</div>


## .pdf Report Structure & Code: 10%

|  Full Credit | Partial Credit ~B | Partial Credit ~C | Partial Credit ~D | No Credit|
|---|---|---|---|---|
| `.html` or pdf and RMD submitted |  | Only one of the 2 files are submitted  | | No files submitted |
| Code is written using "clean" code practices following the Hadley Wickham style guide| Spaces are placed after all # comment tags, variable names do not use periods, or function names. | Clean coding is used in some of the code but spaces or variable names are incorrect 2-4 times| | Clean coding is not implemented consistently throughout the report. |
| Code chunk contains code and runs  | All code runs in the document  | There are 1-2 errors in the code in the document that make it not run | | The are more than 3 code errors in the document |
| All required R packages are listed at the top of the document in a code chunk.  | | Some packages are listed at the top of the document and some are lower down. | | |
| Lines of code are broken up at commas to make the code more readable  | |  | | |


## Knitr pdf Output: 10%

|  Full Credit | Partial Credit ~B | Partial Credit ~C | Partial Credit ~D | No Credit|
|---|---|---|---|---|
| Code chunk arguments are used to hide warnings |  |  | | |
| Code chunk arguments are used to hide code and just show output |  | | |  |
| .pdf report emphasizes the write up and the code outputs rather than showing each step of the code |  | | |  |

## Report Questions: 40%

|  Full Credit | Partial Credit ~B | Partial Credit ~C | Partial Credit ~D | No Credit|
|---|---|---|---|---|
| Student clearly defines Coordinate Reference System (CRS) (paragraph is well written and correctly describes what a CRS is.) |  |  | | |
| Student describes what you need to do when you want to plot 2 spatial datasets in 2 different Coordinate Reference System (CRS) (paragraph is well written and correctly describes the key step.) |  |  | | |
| Student compared the scatter plots of average and max height and determined which relationship is "better" (more comparable)|  |  | | |
| Student references what they see in the scatter plots and the difference bar plots to make their argument for which relationships (average height vs max height) is better. The argument is based upon data results and what they learned in the readings / class. |  |  | | |
| 1-2 readings from the homework are referenced in this paragraph.|  |  | | |
| 3 sources of uncertainty associated with the lidar derived tree heights and the in situ measurements of tree height are discussed in the homework. |||||
| The sources of uncertainty either reference the readings or are other sources discussed in class or observed by the student. |||||

## Plots are Worth 40% of the Assignment Grade

### Plot 1 ggmap() or Maps Basemap Plot 1

|  Full Credit | Partial Credit ~B | Partial Credit ~C | Partial Credit ~D | No Credit|
|---|---|---|---|---|
| Code chunk arguments are used to hide warnings |  |  | | |
| Plot renders on the pdf. |  |  | | |
| Study area location is correct. |  |  | | |
| Plots have a 2-3 sentence caption that clearly describes plot contents. |  |  | | |

### Plot 2 Field Site Detail Map

|  Full Credit | Partial Credit ~B | Partial Credit ~C | Partial Credit ~D | No Credit|
|---|---|---|---|---|
| Roads and plots are included on the map |  |  | | |
| AOI boundary is included on the map. |  |  | | |
| Road lines are symbolized by type. |  |  | | |
| Plot location points are symbolized by type. |  |  | | |
| Plots has a title that clearly defines plot contents. |  |  | | |
| Plots have a 2-3 sentence caption that clearly describes plot contents. |  |  | | |

## Plots 3 & 4 - Scatterplots Insitu vs Lidar

|  Full Credit | Partial Credit ~B | Partial Credit ~C | Partial Credit ~D | No Credit|
|---|---|---|---|---|
| Scatter plot of maximum measured vs lidar tree height is included |  |  | | |
| Scatter plot of average measured vs lidar tree height is included |  |  | | |
| Plots have a title that describes plot contents. |  |  | | |
| X & Y axes are labeled appropriately. |  |  | | |
| Plots have a 2-3 sentence caption that clearly describes plot contents. |  |  | | |

## Plots 5 & 6 - Difference Bar Plot: Insitu vs Lidar

|  Full Credit | Partial Credit ~B | Partial Credit ~C | Partial Credit ~D | No Credit|
|---|---|---|---|---|
| Bar plot of maximum measured minus lidar tree height is included. |  |  | | |
| Bar plot of average measured minus lidar tree height is included. |  |  | | |
| Plots have a title that clearly describes plot contents. |  |  | | |
| X & Y axes are labeled appropriately. |  |  | | |
| Plots have a 2-3 sentence caption that clearly describes plot contents. |  |  | | |

## Graduate Regression Scatter Plot 1

**10% of the regression plot grade**

|  Full Credit | Partial Credit ~B | Partial Credit ~C | Partial Credit ~D | No Credit|
|---|---|---|---|---|
| Bar plot of maximum measured minus lidar tree height is included. |  |  | | Plot is not included |
| Bar plot of average measured minus lidar tree height is included. |  |  | | Plot is not included |
| Plots have a title that clearly describes plot contents. |  |  | | |
| X & Y axes are labeled appropriately. |  |  | | |
| Plots have a 2-3 sentence caption that clearly describes plot contents. |  |  | | |

**90% of the regression plot grade**

|  Full Credit | Partial Credit ~B | Partial Credit ~C | Partial Credit ~D | No Credit|
|---|---|---|---|---|
| 1-2 Paragraphs are included that describe what these plots show in terms of the relationship between lidar and measured tree height and which metrics may or may not be better (average vs maximum height). |  |  | | |


## Example Homework Plots

The plots below are examples of what your plot could look like. Feel free to 
customize or modify plot settings as you see fit!





```
## OGR data source with driver: ESRI Shapefile 
## Source: "data/week_05/california/soap/vector_data/SOAP_centroids.shp", layer: "SOAP_centroids"
## with 50 features
## It has 6 fields
```

<img src="{{ site.url }}/images/rfigs/courses/earth-analytics/00-course-overview/sessions/2017-01-01-week-05/soap-homework-site-plot-1.png" title=" " alt=" " width="90%" />

```
## Error in names(x) <- value: 'names' attribute [12] must be the same length as the vector [8]
## Error in names(x) <- value: 'names' attribute [12] must be the same length as the vector [8]
##  [1] "SOAP27"    "SOAP43"    "SOAP63"    "SOAP91"    "SOAP95"   
##  [6] "SOAP139"   "SOAP143"   "SOAP187"   "SOAP287"   "SOAP299"  
## [11] "SOAP331"   "SOAP351"   "SOAP383"   "SOAP399"   "SOAP422"  
## [16] "SOAP438"   "SOAP447"   "SOAP479"   "SOAP539"   "SOAP639"  
## [21] "SOAP687"   "SOAP715"   "SOAP223"   "SOAP283"   "SOAP991"  
## [26] "SOAP1435"  "SOAP1611"  "SOAP1915"  "SOAP2907"  "SOAP3627" 
## [31] "SOAP127"   "SOAP155"   "SOAP411"   "SOAP415"   "SOAP667"  
## [36] "SOAP1439"  "SOAP1627"  "SOAP1919"  "SOAP1947"  "SOAP2267" 
## [41] "SOAP2459"  "SOAP2463"  "SOAP2719"  "SOAP2911"  "SOAP3391" 
## [46] "SOAP4379"  "SOAP4959"  "SOAP5339"  "SOAP9627"  "SOAP11483"
##  [1] "SOAP43"   "SOAP331"  "SOAP139"  "SOAP1343" "SOAP143"  "SOAP63"  
##  [7] "SOAP1563" "SOAP1695" "SOAP255"  "SOAP1611" "SOAP283"  "SOAP1515"
## [13] "SOAP223"  "SOAP555"  "SOAP299"  "SOAP991"  "SOAP95"   "SOAP187"
## Error in overscope_eval_next(overscope, expr): object 'SOAP_lidar_maxht' not found
```

### Difference bar plots



```r
soap_height_df <- soap_height2@data

soap_height_df <- soap_height_df %>% 
  mutate(insitumax_lidarmax = insitu_max - SOAP_lidar_maxht,
         insitumean_lidarmean = insitu_avg - SOAP_lidar_meanht) %>% 
  filter(!is.na(insitu_avg))
## Error in mutate_impl(.data, dots): Evaluation error: object 'SOAP_lidar_maxht' not found.

ggplot(data = soap_height_df, 
       aes(x = plotid, y = insitumax_lidarmax, fill = plotid)) +
       geom_bar(stat = "identity") +
       labs(title = "Difference: \nLidar avg height - in situ avg height (m)",
             x = "Plot Name",
             y = "Height difference (m)") + 
  guides(fill = FALSE) # remove legend
## Error in FUN(X[[i]], ...): object 'insitumax_lidarmax' not found
```

<img src="{{ site.url }}/images/rfigs/courses/earth-analytics/00-course-overview/sessions/2017-01-01-week-05/unnamed-chunk-2-1.png" title=" " alt=" " width="90%" />


### Scatter plots 


```
## Error in filter_impl(.data, quo): Evaluation error: object 'SOAP_lidarCHM.y' not found.
```


```
## Error in filter_impl(.data, quo): Evaluation error: object 'SOAP_lidarCHM.x' not found.
```
